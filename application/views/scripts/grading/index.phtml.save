<?php
$seminarMapper = new Application_Model_SeminarMapper();
$surveyMapper = new Application_Model_SurveyMapper();

// get all seminars for curent academic year
$pyear = 3;
$section = 1;
$seminars = $seminarMapper->findCurrentSeminars($pyear, $section);

// get surveys for each seminar
foreach($seminars as $index => $seminar) {
	$surveys = $surveyMapper->getSeminarSurveys($seminar['seminar_id']);
	$seminars[$index]['surveys'] = $surveys;
}

?>
<div class="container-fluid">
	<div class="row-fluid span12">
		<div class="btn-group span1 year_section" data-toggle="buttons-radio" id="pyear-buttons">
		  <button type="button" class="btn" value="p3">P3</button>
		  <button type="button" class="btn" value="p4">P4</button>
		</div>

		<div class="btn-group span4 year_section" data-toggle="buttons-radio" id="section-buttons">
		  <button type="button" class="btn" value="s1">Section 1</button>
		  <button type="button" class="btn" value="s2">Section 2</button>
		  <button type="button" class="btn" value="s3">Section 3</button>
		  <button type="button" class="btn" value="s4">Section 4</button>
		  <button type="button" class="btn" value="s5">Section 5</button>
		</div>

	</div><!-- end row-fluid span12 -->
	<div class="row-fluid span12">
		<h3><?php echo "Development Seminar Settings: P$pyear - Section $section"; ?></h3>
	</div><!-- end row-fluid span12 -->



<?php foreach($seminars as $data): ?>
	<div class="row-fluid span12">
	<h4 "span2">
	<?php echo $data['presenter_last_name'] . ', ' . $data['presenter_first_name'] . '(' . $data['presenter_user_id']  . ') - ' . $data['presenter_unid'] . ' - ' . $data['seminar_date']; ?>
	</h4>
	<?php if(!empty($data['surveys'])): ?>		

	<table  cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered table-condensed" id="surveys">
		<caption></caption>
		<colgroup />
		<colgroup span="2" title="title" />
		<thead>
			<tr>
				<th scope="col" colspan="10">Survey Data Averages</th>
				<th scope="col" colspan="4">Scores</th>
			</tr>
			<tr>
				<th scope="col">Presentation</br>Style</th>
				<th scope="col">Instructional</br>Materials</th>
				<th scope="col">Overall</br>Presentation</th>
				<th scope="col">Clinical</br>Data</th>
				<th scope="col">Conclusions</th>
				<th scope="col">Q &amp; A</th>
				<th scope="col">Overall</br>Knowledge</th>
				<th scope="col">F1</th>
				<th scope="col">F2</th>
				<th scope="col">F3</th>
				<th scope="col">Total</th>
			</tr>	
		</thead>
		<tfoot>
			<tr>
				
			</tr>
		</tfoot>
		<tbody>		
			<tr>
				<?php foreach($this->surveyAverages($data['surveys']) as $field): ?>
				<td><?php echo $field['average']; ?></td>
				<?php endforeach; ?>
				<td class="edit" id="f1_<?php echo $data['presenter_user_section_id']; ?>"</td>
				<td class="edit" id="f2_<?php echo $data['presenter_user_section_id']; ?>"</td>
				<td><?php echo $this->attendanceScore($data['presenter_user_section_id']); ?></td>
				<td></td>
			</tr>
		</tbody>
	</table>

	<table  cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered table-condensed" id="surveys">
		<caption></caption>
		<colgroup />
		<colgroup span="2" title="title" />
		<thead>
			<tr>
				<th scope="col" colspan="2">Reviewer</th>
				<th scope="col" colspan="10">Survey Data</th>
			</tr>
			<tr>
				<th scope="col">Name</th>
				<th scope="col">unid</th>
				<th scope="col" colspan="5">Presentation Style</th>
				<th scope="col" colspan="5">Instructional Materials</th>
				<th scope="col" colspan="6">Overall Presentation</th>
				<th scope="col" colspan="7">Clinical Data</th>
				<th scope="col" colspan="5">Conclusions</th>
				<th scope="col" colspan="3">Q &amp; A</th>
				<th scope="col" colspan="6">Overall Knowledge</th>
				<th scope="col">Liked</th>
				<th scope="col">Needs Improvement</th>
				<th scope="col">General</th>
			</tr>	
		</thead>
		<tfoot>
			<tr>
			</tr>
		</tfoot>
		<tbody>
			<?php foreach($data['surveys'] as $survey): ?>
			<tr>
				<td><?php echo $survey['reviewer']['last_name'] . ', ' . $survey['reviewer']['first_name']; ?></td>
				<td><?php echo $survey['reviewer']['unid']; ?></td>
				<?php foreach($survey as $key => $value): ?>
				<?php if(in_array($key, array('id', 'seminar_id', 'reviewer_user_section_id','survey_date', 'qualtrics_is', 'grade_sum','grade_weighted_average','grade_standard_deviation', 'updated', 'reviewer'))): ?>
					<?php continue; ?>
				<?php endif; ?>
					<?php if(strstr($key, 'ps_')): ?>
						<td><?php echo $survey[$key]; ?></td>	
					<?php endif;?>

					<?php if(strstr($key, 'im_')): ?>
						<td><?php echo $survey[$key]; ?></td>	
					<?php endif;?>

					<?php if(strstr($key, 'op_')): ?>
						<td><?php echo $survey[$key]; ?></td>	
					<?php endif;?>

					<?php if(strstr($key, 'cd_')): ?>
						<td><?php echo $survey[$key]; ?></td>	
					<?php endif;?>

					<?php if(strstr($key, 'cc_')): ?>
						<td><?php echo $survey[$key]; ?></td>	
					<?php endif;?>

					<?php if(strstr($key, 'qa_')): ?>
						<td><?php echo $survey[$key]; ?></td>	
					<?php endif;?>

					<?php if(strstr($key, 'ok_')): ?>
						<td><?php echo $survey[$key]; ?></td>	
					<?php endif;?>

					<?php if(strstr($key, 'comments_')): ?>
						<td><?php echo $survey[$key]; ?></td>	
					<?php endif;?>

				<?php endforeach; ?>
			</tr>
			<?php endforeach; ?>
		</tbody>
	</table>
	<?php else: ?>
	<p>No sureveys recorded for this seminar</p>
	<?php endif; ?>
	</div> <!-- end row-fluid span12 -->
<?php endforeach; ?>

</div> <!-- end container-fluid -->
